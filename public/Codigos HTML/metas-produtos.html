<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Premiação</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#94a3b8;
  --accent:#2dd4bf;
  --accent-2:#60a5fa;
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.02);
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#071023 0%, #051827 100%);color:#e6eef6}
.app{display:flex;height:100vh;gap:20px;padding:28px}
.sidebar{width:320px;background:linear-gradient(180deg,var(--card),#061226);border-radius:14px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
.brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#021024;font-size:16px}
h1{font-size:18px;margin:0}
.muted{color:var(--muted);font-size:13px;margin-top:4px}
.controls{margin-top:18px}
.filter{background:var(--glass);padding:12px;border-radius:10px;margin-bottom:12px}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input[type="text"],input[type="number"],select{width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.btn{display:inline-block;padding:10px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#021024;font-weight:600;border:0;cursor:pointer}
.btn.danger{background:transparent;border:1px solid rgba(239,68,68,0.6);color:#ef4444;}
.main{flex:1;display:flex;flex-direction:column;gap:18px}
.header{display:flex;justify-content:space-between;align-items:center}
.summary{display:flex;gap:16px;align-items:center}
.kpi{background:var(--glass-2);padding:14px;border-radius:12px;min-width:160px}
.kpi h3{margin:0;font-size:13px;color:var(--muted)}
.kpi p{margin:6px 0 0;font-size:20px;font-weight:700}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.6);min-height:200px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.card h4{margin:0 0 6px 0;font-size:14px}
.meta{font-size:12px;color:var(--muted);margin-top:8px;text-align:center}
.last-saved{font-size:12px;color:var(--muted);margin-top:6px}
.clear-btn{position:absolute;top:6px;right:6px;padding:2px 6px;font-size:10px;background:rgba(255,255,255,0.05);color:var(--accent-2);border:none;border-radius:6px;cursor:pointer}
.clear-btn:hover{background:rgba(255,255,255,0.12);}
@media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:700px){.app{flex-direction:column;padding:12px}.sidebar{width:100%;order:2}.main{order:1}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
<aside class="sidebar">
<div class="brand">
  <div class="logo">VD</div>
  <div>
    <h1>Dashboard Premiação</h1>
    <div class="muted">Selecione o período</div>
  </div>
</div>

<div class="controls">
  <div class="filter">
    <label>Mês</label>
    <select id="selectMonth">
      <option value="1">Janeiro</option>
      <option value="2">Fevereiro</option>
      <option value="3">Março</option>
      <option value="4">Abril</option>
      <option value="5">Maio</option>
      <option value="6">Junho</option>
      <option value="7">Julho</option>
      <option value="8">Agosto</option>
      <option value="9">Setembro</option>
      <option value="10">Outubro</option>
      <option value="11">Novembro</option>
      <option value="12">Dezembro</option>
    </select>
  </div>
  <div class="filter">
    <label>Ano</label>
    <select id="selectYear">
      <option value="2025" selected>2025</option>
      <option value="2026">2026</option>
      <option value="2027">2027</option>
    </select>
  </div>

  <div class="filter">
    <label>Nome da Linha</label>
    <input id="editName" type="text" />
    <label style="margin-top:8px">Meta (R$)</label>
    <input id="editMeta" type="number" step="0.01" />
    <label style="margin-top:8px">Realizado (R$)</label>
    <input id="editReal" type="number" step="0.01" />
    <label style="margin-top:8px">Prêmio (R$)</label>
    <input id="editPremio" type="number" step="0.01" />

    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
      <button class="btn" id="saveBtn">Adicionar Produto</button>
      <button class="btn danger" id="clearAllBtn">Apagar Tudo</button>
    </div>

    <div id="lastSaved" class="last-saved">Último salvamento: —</div>
  </div>
</aside>

<main class="main">
<div class="header">
  <div class="summary">
    <div class="kpi"><h3>Total Meta</h3><p id="totalMeta">R$ 0,00</p></div>
    <div class="kpi"><h3>Total Realizado</h3><p id="totalReal">R$ 0,00</p></div>
    <div class="kpi"><h3>% Geral Atingido</h3><p id="totalPct">0%</p></div>
    <div class="kpi"><h3>Premiação Total</h3><p id="totalPrize">R$ 0,00</p></div>
  </div>
</div>

<section class="grid" id="chartsGrid"></section>
</main>
</div>

<script>
let data = [];
const $ = id=>document.getElementById(id);
const charts = {};

function currencyBR(v){return 'R$ '+Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});}
function normalizeItem(it){return {id:Number(it.id)||Math.floor(Math.random()*1000000),name:String(it.name||'NOVA LINHA'),meta:Number(it.meta)||0,real:Number(it.real)||0,premio:Number(it.premio)||0};}

function createCard(d){
    const container = document.createElement('div');
    container.className = 'card';

    const clearBtn = document.createElement('button');
    clearBtn.className = 'clear-btn';
    clearBtn.textContent = '✕';
    clearBtn.addEventListener('click', ()=>{
        if(confirm(`Deseja apagar "${d.name}"?`)){
            data = data.filter(x=>x.id!==d.id);
            renderCards();
            recomputeTotals();
            saveToStorage();
        }
    });
    container.appendChild(clearBtn);

    const title = document.createElement('h4');
    title.textContent = d.name;
    container.appendChild(title);

    const canvas = document.createElement('canvas');
    container.appendChild(canvas);

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `<div>Meta: ${currencyBR(d.meta)}</div><div>Realizado: ${currencyBR(d.real)}</div><div>Prêmio: ${currencyBR(d.premio)}</div>`;
    container.appendChild(meta);

    // cálculo percentual real
    const value = d.meta>0?d.real/d.meta:0;
    const pct = Math.round(value*100);

    // cor da rosca conforme regra
    let corPrincipal;
    if(pct < 50) corPrincipal='rgba(239,68,68,0.95)';       // vermelho
    else if(pct < 80) corPrincipal='rgba(234,179,8,0.95)';  // amarelo
    else if(pct <= 100) corPrincipal='rgba(34,197,94,0.95)';// verde
    else corPrincipal='rgba(59,130,246,0.95)';             // azul

    const centerText = {
        id:'centerText',
        beforeDraw(chart){
            const {ctx,width,height} = chart;
            ctx.save();
            ctx.font='700 18px Inter, sans-serif';
            ctx.fillStyle='#e6eef6';
            ctx.textAlign='center';
            ctx.textBaseline='middle';
            ctx.fillText(pct+'%', width/2, height/2);
        }
    };

    const chart = new Chart(canvas.getContext('2d'),{
        type:'doughnut',
        data:{
            labels:['Atingido','Restante'],
            datasets:[{
                data:[Math.min(value,1), Math.max(1-Math.min(value,1),0)],
                backgroundColor:[corPrincipal,'rgba(255,255,255,0.04)']
            }]
        },
        options:{
            cutout:'68%',
            plugins:{legend:{display:false},tooltip:{enabled:false}},
            animation:{animateRotate:true,duration:1000,easing:'easeOutCubic'}
        },
        plugins:[centerText]
    });

    charts[d.id] = chart;
    return container;
}

function renderCards(){
    const grid = $('chartsGrid');
    grid.innerHTML = '';
    Object.keys(charts).forEach(id=>{charts[id].destroy(); delete charts[id];});
    data.forEach(d=>grid.appendChild(createCard(d)));
}

function recomputeTotals(){
    const meta = data.reduce((s,i)=>s+i.meta,0);
    const real = data.reduce((s,i)=>s+i.real,0);
    const prize = data.reduce((s,i)=>s+i.premio,0);
    $('totalMeta').textContent = currencyBR(meta);
    $('totalReal').textContent = currencyBR(real);
    $('totalPct').textContent = meta>0?Math.round(real/meta*100)+'%':'0%';
    $('totalPrize').textContent = currencyBR(prize);
}

$('saveBtn').addEventListener('click', ()=>{
    const name = $('editName').value.trim();
    if(!name){ alert('Informe o nome da linha!'); return; }
    const meta = Number($('editMeta').value)||0;
    const real = Number($('editReal').value)||0;
    const premio = Number($('editPremio').value)||0;

    const item = normalizeItem({name,meta,real,premio});
    data.push(item);
    renderCards();
    recomputeTotals();
    saveToStorage();
});

function saveToStorage(){
    const y = $('selectYear').value;
    const m = $('selectMonth').value;
    localStorage.setItem(`dashboard_data_${y}_${m}`,JSON.stringify({data,savedAt:new Date().toISOString()}));
}

function loadFromStorage(){
    const y = $('selectYear').value;
    const m = $('selectMonth').value;
    const raw = localStorage.getItem(`dashboard_data_${y}_${m}`);
    if(raw){
        const parsed = JSON.parse(raw);
        data = parsed.data.map(normalizeItem);
    } else data=[];
    renderCards();
    recomputeTotals();
}

$('selectYear').addEventListener('change', loadFromStorage);
$('selectMonth').addEventListener('change', loadFromStorage);

$('clearAllBtn').addEventListener('click', ()=>{
    if(!confirm('Apagar todos os dados?')) return;
    data=[]; renderCards(); recomputeTotals();
    Object.keys(localStorage).forEach(k=>{ if(k.startsWith('dashboard_data_')) localStorage.removeItem(k); });
});

loadFromStorage();
</script>
</body>
</html>
