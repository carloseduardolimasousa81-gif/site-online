<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Corrida de Vendas - Ranking Top 9</title>
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#f4f5f8;
  overflow-x:hidden;
}
header{
  background:#003366;
  color:#fff;
  padding:20px;
  text-align:center;
  font-size:24px;
  font-weight:700;
}
.container{
  display:flex;
  flex-direction:row;
  padding:20px;
  gap:20px;
}
#sidebar{
  width:340px;
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  overflow-y:auto;
  height:calc(100vh - 100px);
}
#main{
  flex:1;
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
button{
  background:#003366;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  cursor:pointer;
  font-weight:600;
  margin:4px 2px;
}
button:hover{background:#00509e;}
.track-lane{
  position:relative;
  width:100%;
  height:80px;
  margin-bottom:15px;
  background:#f0f3f8;
  border-radius:40px;
  overflow:hidden;
}
.modalRunner{
  position:absolute;
  top:10px;
  left:0;
  display:flex;
  align-items:center;
  gap:8px;
  transition: left 3s ease-out;
}
.modalRunner img{
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  background:#fff;
  border:2px solid #003366;
}
#raceModal{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
#modalContent{
  background:white;
  border-radius:16px;
  width:90%;
  max-width:1000px;
  max-height:90%;
  overflow:auto;
  padding:20px;
  position:relative;
}
#modalTrack{
  position:relative;
  margin-top:20px;
}
#modalTrack::after{
  content:"";
  position:absolute;
  top:0;bottom:0;
  right:60px; /* Linha de chegada */
  width:6px;
  background:#ff0000;
  border-radius:3px;
}
#podium{
  display:none;
  text-align:center;
  font-size:20px;
  margin-top:30px;
}
.runner-edit-box img{
  width:80px;
  height:80px;
  border-radius:50%;
  object-fit:cover;
  display:block;
  margin:8px auto;
  border:2px solid #003366;
}
.runner-edit-box h3{text-align:center;margin:10px 0;}
.form-group{margin-bottom:8px;}
.form-group label{display:block;font-size:14px;color:#333;}
.form-group input{width:100%;padding:6px;border-radius:6px;border:1px solid #ccc;}
.form-actions{text-align:center;margin-top:10px;}
</style>
</head>
<body>
<header>üèÅ Corrida de Vendas - Ranking Top 9</header>
<div class="container">
  <div id="sidebar">
    <button id="startRaceBtn">Iniciar Corrida</button>
    <button id="resetRaceBtn">Resetar Posi√ß√µes</button>
    <button id="saveBtn">Salvar Dados</button>
    <button id="clearBtn">Limpar Tudo</button>
  </div>
  <div id="main">
    <div id="lanes"></div>
  </div>
</div>

<!-- Modal da Corrida -->
<div id="raceModal">
  <div id="modalContent">
    <h2 style="text-align:center;">üèéÔ∏è Corrida em Andamento</h2>
    <div id="modalTrack"></div>
    <div id="podium"></div>
    <button style="margin-top:20px;" onclick="closeModal()">Fechar</button>
  </div>
</div>

<script>
let groups = [
  { name:'Grupo √önico', runners:[
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
    {nome:'',vendas:0,crescimento:0,peso:0,img:''},
  ]}
];
const STORAGE_KEY='corridaVendasRankingTop9';

function abrirModalCorrida(){
  const modal = document.getElementById('raceModal');
  const modalTrack = document.getElementById('modalTrack');
  const podium = document.getElementById('podium');
  modal.style.display='flex';
  podium.style.display='none';
  modalTrack.innerHTML='';

  const allRunners = [];
  groups.forEach((g,gi)=>g.runners.forEach((r,ri)=>allRunners.push({ g:gi, r:ri, nome:r.nome, vendas:r.vendas, img:r.img })));

  const trackWidth = modalTrack.clientWidth - 200; // Linha de chegada recuada
  const maxSales = Math.max(...allRunners.map(x=>x.vendas));

  allRunners.forEach((r,i)=>{
    const lane = document.createElement('div');
    lane.className='track-lane';
    modalTrack.appendChild(lane);

    const runnerEl = document.createElement('div');
    runnerEl.className='modalRunner';
    runnerEl.style.left='-60px';
    runnerEl.innerHTML=`
      <img src="${r.img||'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width=60 height=60><rect rx=12 width=100% height=100% fill=%23f3f4f6/><text x=50% y=50% font-size=26 dominant-baseline=middle text-anchor=middle>üèÉ</text></svg>'}">
      <div style="color:#003366;font-weight:600;">${r.nome||'Sem nome'}</div>
    `;
    lane.appendChild(runnerEl);

    const pct = maxSales>0 ? r.vendas/maxSales : 0;
    const destino = pct * trackWidth;
    let pos = -60;
    const duracao = 3000;
    const start = performance.now();

    function animar(t){
      const tempo = t - start;
      const progresso = Math.min(tempo / duracao, 1);
      pos = -60 + (destino + 60) * progresso;
      runnerEl.style.left = pos + 'px';
      if(progresso < 1) requestAnimationFrame(animar);
    }
    requestAnimationFrame(animar);
  });

  setTimeout(()=>{
    const top3 = [...allRunners].sort((a,b)=>b.vendas-a.vendas).slice(0,3);
    podium.innerHTML = `
      <div>ü•á ${top3[0]?.nome||''} ‚Äî ${top3[0]?.vendas.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</div>
      <div>ü•à ${top3[1]?.nome||''} ‚Äî ${top3[1]?.vendas.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</div>
      <div>ü•â ${top3[2]?.nome||''} ‚Äî ${top3[2]?.vendas.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</div>
    `;
    podium.style.display='block';
  }, 3200);
}

function closeModal(){document.getElementById('raceModal').style.display='none'}

function loadFromStorage(){
  try{
    const raw=localStorage.getItem(STORAGE_KEY);
    if(raw){const parsed=JSON.parse(raw);if(Array.isArray(parsed)&&parsed.length) groups=parsed}
  }catch(e){console.warn(e)}
}
function saveToStorage(){localStorage.setItem(STORAGE_KEY,JSON.stringify(groups))}
function fmtCurrency(v){return v.toLocaleString('pt-BR',{ style:'currency', currency:'BRL' })}

const lanesEl=document.getElementById('lanes');
const sidebarEl=document.getElementById('sidebar');

function renderRace(){
  lanesEl.innerHTML=''; sidebarEl.querySelectorAll('.runner-edit-box').forEach(n=>n.remove());
  groups.forEach((group,gIndex)=>{
    group.runners.forEach((runner,rIndex)=>{
      const lane=document.createElement('div'); lane.className='track-lane';
      const runnerWrap=document.createElement('div'); runnerWrap.className='runner-wrapper';
      const runnerEl=document.createElement('div'); runnerEl.className='runner'; runnerEl.dataset.g=gIndex; runnerEl.dataset.r=rIndex;
      const img=document.createElement('img');
      img.src=runner.img||'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width=80 height=80><rect rx=12 width=100% height=100% fill=%23f3f4f6/><text x=50% y=50% font-size=28 dominant-baseline=middle text-anchor=middle>üèÉ</text></svg>';
      img.style.width='60px';img.style.height='60px';img.style.borderRadius='50%';
      runnerEl.appendChild(img);
      runnerEl.innerHTML+=`<div style="font-weight:600;color:#003366">${runner.nome||'Vazio'}</div>`;
      runnerWrap.appendChild(runnerEl); lane.appendChild(runnerWrap); lanesEl.appendChild(lane);

      const editBox=document.createElement('div'); editBox.className='runner-edit-box';
      editBox.innerHTML=`
        <h3>${runner.nome||'Vazio'}</h3>
        <img id="editImg-${gIndex}-${rIndex}" src="${runner.img||''}">
        <div class="form-group"><label>Nome</label><input id="editNome-${gIndex}-${rIndex}" value="${runner.nome||''}"></div>
        <div class="form-group"><label>Vendas (R$)</label><input type="number" id="editVendas-${gIndex}-${rIndex}" value="${runner.vendas||0}"></div>
        <div class="form-group"><label>Crescimento (%)</label><input type="number" id="editCrescimento-${gIndex}-${rIndex}" value="${runner.crescimento||0}"></div>
        <div class="form-group"><label>Peso (kg)</label><input type="number" id="editPeso-${gIndex}-${rIndex}" value="${runner.peso||0}"></div>
        <div class="form-group"><label>Foto</label><input type="file" id="editFile-${gIndex}-${rIndex}" accept="image/*"></div>
        <div class="form-actions"><button onclick="updateRunner(${gIndex},${rIndex})">Atualizar</button></div>
      `;
      sidebarEl.appendChild(editBox);
    });
  });
}

function updateRunner(g,r){
  const runner = groups[g].runners[r];
  runner.nome=document.getElementById(`editNome-${g}-${r}`).value.trim();
  runner.vendas=Number(document.getElementById(`editVendas-${g}-${r}`).value)||0;
  runner.crescimento=Number(document.getElementById(`editCrescimento-${g}-${r}`).value)||0;
  runner.peso=Number(document.getElementById(`editPeso-${g}-${r}`).value)||0;
  const fileInput=document.getElementById(`editFile-${g}-${r}`);
  if(fileInput.files[0]){
    const reader=new FileReader();
    reader.onload=e=>{runner.img=e.target.result; saveToStorage(); renderRace();}
    reader.readAsDataURL(fileInput.files[0]);
  } else { saveToStorage(); renderRace(); }
}

function resetPositions(){
  document.querySelectorAll('.runner').forEach(el=>el.style.transform='translateX(0px)');
}
function clearAll(){
  if(!confirm('Deseja realmente limpar todos os dados?')) return;
  groups=groups.map(g=>({ name:g.name, runners:g.runners.map(()=>({nome:'',vendas:0,crescimento:0,peso:0,img:''}))}));
  saveToStorage(); renderRace();
}

document.getElementById('startRaceBtn').addEventListener('click',abrirModalCorrida);
document.getElementById('resetRaceBtn').addEventListener('click',resetPositions);
document.getElementById('clearBtn').addEventListener('click',clearAll);
document.getElementById('saveBtn').addEventListener('click',()=>{ saveToStorage(); alert('Salvo localmente.'); });

loadFromStorage(); renderRace();
</script>
</body>
</html>
